<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gridiron Vault</title>

<!-- OCR Library -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
  body {
    background:#0f172a;
    color:white;
    font-family:Arial;
    margin:0;
    padding:20px;
  }
  nav a {
    margin-right:15px;
    color:#38bdf8;
    cursor:pointer;
    text-decoration:none;
    font-weight:bold;
  }
  .section { display:none; }
  .card {
    background:#1e293b;
    padding:12px;
    margin:10px 0;
    border-radius:8px;
  }
  button {
    padding:8px;
    margin-top:6px;
    cursor:pointer;
  }
</style>
</head>

<body>

<h1>üèà Gridiron Vault</h1>

<nav>
  <a onclick="show('scan')">üì∏ Scan</a>
  <a onclick="show('collection')">üì¶ Collection</a>
  <a onclick="show('trade')">üîÅ Trade</a>
</nav>

<hr>

<!-- SCAN SECTION -->
<div id="scan" class="section">
  <h2>Scan Football Card</h2>
  <input type="file" accept="image/*" onchange="scanCard(event)">
  <p id="scanStatus"></p>
</div>

<!-- COLLECTION SECTION -->
<div id="collection" class="section">
  <h2>Your Collection</h2>
  <div id="collectionList"></div>
  <h3 id="totalValue"></h3>
</div>

<!-- TRADE SECTION -->
<div id="trade" class="section">
  <h2>Trade Hub</h2>
  <p>You (Evan) ‚Üî Alex</p>
  <div id="tradeCards"></div>
  <div id="tradeRequests"></div>
</div>

<script>
/* ------------------ DATA ------------------ */
let users = [
  { id: 1, name: "Evan" },
  { id: 2, name: "Alex" }
];

let cards = JSON.parse(localStorage.getItem("cards")) || [
  { id: 1, player: "Patrick Mahomes", owner: 1, value: 250 },
  { id: 2, player: "Josh Allen", owner: 2, value: 200 }
];

let trades = JSON.parse(localStorage.getItem("trades")) || [];

/* ------------------ NAV ------------------ */
function show(section) {
  document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
  document.getElementById(section).style.display = 'block';
  render();
}
show('scan');

/* ------------------ SCANNING ------------------ */
function scanCard(event) {
  const img = event.target.files[0];
  scanStatus.innerText = "Scanning...";

  Tesseract.recognize(img, 'eng').then(({ data: { text } }) => {
    const card = {
      id: Date.now(),
      player: detectPlayer(text),
      owner: 1,
      value: estimateValue(text)
    };
    cards.push(card);
    save();
    scanStatus.innerText = "Card added!";
  });
}

function detectPlayer(text) {
  if (text.includes("Mahomes")) return "Patrick Mahomes";
  if (text.includes("Burrow")) return "Joe Burrow";
  if (text.includes("Allen")) return "Josh Allen";
  return "Unknown Player";
}

function estimateValue(text) {
  if (text.includes("Mahomes")) return 250;
  if (text.includes("Allen")) return 200;
  return 25;
}

/* ------------------ TRADING ------------------ */
function offerTrade(cardId) {
  const targetCard = cards.find(c => c.owner === 2);
  trades.push({
    id: Date.now(),
    offered: cardId,
    requested: targetCard.id,
    status: "pending"
  });
  save();
  render();
}

function acceptTrade(id) {
  const trade = trades.find(t => t.id === id);
  swap(trade.offered, trade.requested);
  trade.status = "accepted";
  save();
  render();
}

function swap(a, b) {
  const cardA = cards.find(c => c.id === a);
  const cardB = cards.find(c => c.id === b);
  [cardA.owner, cardB.owner] = [cardB.owner, cardA.owner];
}

/* ------------------ RENDER ------------------ */
function render() {
  renderCollection();
  renderTrade();
}

function renderCollection() {
  collectionList.innerHTML = "";
  let total = 0;

  cards.filter(c => c.owner === 1).forEach(c => {
    total += c.value;
    collectionList.innerHTML += `
      <div class="card">
        ${c.player}<br>
        Value: $${c.value}
      </div>`;
  });

  totalValue.innerText = "Total Value: $" + total;
}

function renderTrade() {
  tradeCards.innerHTML = "<h3>Your Cards</h3>";
  tradeRequests.innerHTML = "<h3>Requests</h3>";

  cards.filter(c => c.owner === 1).forEach(c => {
    tradeCards.innerHTML += `
      <div class="card">
        ${c.player}
        <button onclick="offerTrade(${c.id})">Offer Trade</button>
      </div>`;
  });

  trades.filter(t => t.status === "pending").forEach(t => {
    tradeRequests.innerHTML += `
      <div class="card">
        Trade Request
        <button onclick="acceptTrade(${t.id})">Accept</button>
      </div>`;
  });
}

/* ------------------ SAVE ------------------ */
function save() {
  localStorage.setItem("cards", JSON.stringify(cards));
  localStorage.setItem("trades", JSON.stringify(trades));
}

render();
</script>

</body>
</html>
